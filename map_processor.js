'use strict';

var mapProcessor = function($replace, options) {
  var config,
      ext = '.jpg',
      getCounty, getSrc,
      $img = jQuery('<img />'),
      initialize,
      self = {},
      urlBase = 'https://raw.githubusercontent.com/hungerfreevermont/countymap/master/images/';

  config = [
    {
      title: 'Grand Isle County',
      filename: 'grandisle.pdf',
      coords: {
        full: '339,91,332,79,340,64,318,65,312,102,318,141,313,158,320,166,332,154',
        small: '44,63,68,63,61,78,66,90,67,97,67,104,64,113,63,124,63,136,62,148,58,158,53,161,46,168,40,154,45,141,42,122,49,112,38,100,44,86'
      }
    }, {
      title: 'Franklin County',
      filename: 'franklin.pdf',
      coords: {
        full: '406,130,414,112,439,106,444,109,450,101,446,62,420,61,344,63,336,79,344,87,339,130,386,147,399,130',
        small: '70,62,173,60,175,73,177,94,176,102,171,110,162,107,143,111,137,127,133,132,127,130,126,129,123,135,115,147,104,146,64,130,69,104,69,91,63,79'
      }
    }, {
      title: 'Orleans County',
      filename: 'orleans.pdf',
      coords: {
        full: '452,104,450,61,555,56,550,77,557,88,536,126,523,118,516,128,495,163,465,145,474,127,448,110',
        small: '176,60,221,58,252,56,280,55,280,64,278,76,278,82,284,86,272,104,274,110,263,126,248,117,249,128,242,128,223,163,209,157,208,152,205,152,191,145,200,127,173,110,178,102,180,92'
      }
    }, {
      title: 'Essex County',
      filename: 'essex.pdf',
      coords: {
        full: '615,53,619,76,599,119,618,151,610,160,612,171,606,175,602,177,596,189,573,205,558,185,568,173,560,162,567,146,561,139,569,124,548,109,560,86,554,76,559,57',
        small: '282,55,343,52,341,61,346,72,346,80,328,117,344,151,336,158,339,165,335,176,328,176,326,189,299,206,284,185,294,174,286,164,294,146,286,138,294,124,274,106,286,85,279,78'
      }
    }, {
      title: 'Chittenden County',
      filename: 'chittenden.pdf',
      coords: {
        full: '329,233,372,228,375,222,385,226,388,246,397,216,408,205,404,200,410,190,406,188,409,179,406,174,407,169,390,150,380,150,339,134,336,156,330,163,322,169,330,195,326,212,326,224',
        small: '49,164,59,159,62,152,66,131,106,148,116,148,134,168,133,174,136,180,134,186,136,191,131,199,135,206,125,215,115,246,112,228,107,223,98,228,55,232,50,217,51,208,56,201,49,163,100,222'
      }
    }, {
      title: 'Lamoille County',
      filename: 'lamoille.pdf',
      coords: {
        full: '391,147,410,169,409,173,414,178,410,187,435,197,444,182,462,189,479,157,463,147,470,128,439,110,417,115,410,133,403,133',
        small: '116,147,127,131,134,134,143,112,156,110,166,110,197,127,189,146,206,156,189,190,172,181,162,198,135,186,138,179,136,173,136,170,124,152'
      }
    }, {
      title: 'Caledonia County',
      filename: 'caledonia.pdf',
      coords: {
        full: '474,176,500,188,509,197,488,244,496,248,514,245,523,245,536,251,538,237,536,231,545,213,568,208,554,187,565,173,557,164,564,147,558,140,565,126,549,112,539,130,524,123,527,132,514,132,500,166,482,161',
        small: '208,158,224,166,242,130,252,131,250,120,263,129,276,110,292,124,283,138,291,145,284,164,292,173,282,185,297,208,281,214,272,213,266,217,261,230,265,237,263,251,248,245,236,244,223,248,214,244,226,211,235,198,226,187,200,176'
      }
    }, {
      title: 'Addison County',
      filename: 'addison.pdf',
      coords: {
        full: '320,352,317,335,321,326,311,313,313,294,306,283,312,275,311,268,317,257,316,248,328,236,373,231,377,225,384,232,385,247,390,261,393,277,423,288,414,306,405,323,400,318,384,326,387,333,381,338,376,329,345,332,346,349',
        small: '54,234,99,230,101,223,108,226,112,240,118,260,122,277,130,278,151,286,141,304,132,324,130,324,129,319,126,318,111,326,114,334,107,339,102,329,71,332,73,348,47,352,43,333,48,327,39,317,37,308,39,294,32,284,38,273,37,266,43,254,42,248'
      }
    }, {
      title: 'Washington County',
      filename: 'washington.pdf',
      coords: {
        full: '430,287,396,275,394,260,391,252,400,218,412,207,408,200,413,191,437,201,445,186,462,193,471,179,497,189,506,199,486,242,480,240,473,246,471,258,456,254,446,257',
        small: '138,188,162,200,171,184,189,193,198,176,222,187,233,198,212,242,205,241,200,246,199,258,192,258,181,254,175,255,158,287,132,276,123,276,116,250,124,219,136,205,133,198'
      }
    }, {
      title: 'Orange County',
      filename: 'orange.pdf',
      coords: {
        full: '515,343,425,312,418,307,427,289,434,291,449,261,454,257,473,261,477,247,481,243,494,252,518,248,538,255,538,269,530,292,529,302,520,321',
        small: '152,287,158,290,174,258,180,256,195,260,201,261,202,247,206,241,220,250,225,250,236,246,244,246,266,253,266,267,268,272,255,294,258,300,243,344,151,312,143,304'
      }
    }, {
      title: 'Rutland County',
      filename: 'rutland.pdf',
      coords: {
        full: '343,454,345,407,336,394,336,386,331,383,324,383,319,392,313,384,315,374,322,364,321,355,350,352,348,335,374,333,379,343,401,331,418,337,413,352,415,362,432,368,417,402,418,411,429,420,426,437,419,439,410,439,407,454,393,454,390,458,372,453',
        small: '47,353,75,350,73,333,86,332,101,331,105,342,128,329,131,335,134,333,144,337,143,344,138,352,142,360,158,367,157,374,145,397,144,409,156,419,152,433,148,439,140,437,135,442,134,454,120,454,116,458,110,454,69,453,71,412,67,400,61,393,63,387,57,384,51,383,46,394,43,394,38,386,38,380,46,365'
      }
    }, {
      title: 'Windsor County',
      filename: 'windsor.pdf',
      coords: {
        full: '418,464,434,470,480,466,484,447,482,432,487,414,483,403,496,380,497,358,513,346,415,311,407,327,400,323,388,328,390,333,400,328,422,335,416,353,420,359,436,369,421,404,425,412,433,417,432,433,424,442,412,442,409,455,416,457',
        small: '114,325,126,319,130,326,134,325,138,312,143,306,150,313,241,345,225,359,223,379,211,399,214,408,211,434,213,442,208,467,191,467,172,469,155,469,144,464,144,457,135,454,135,446,139,440,148,440,158,419,146,408,147,398,161,369,156,363,144,359,142,350,147,340,144,333,133,331,127,327,116,333'
      }
    }, {
      title: 'Bennington County',
      filename: 'bennington.pdf',
      coords: {
        full: '400,585,344,584,340,576,343,561,342,540,343,458,371,457,389,462,394,457,407,458,414,459,413,464,407,498,386,496,385,544,400,544,398,576',
        small: '69,454,109,456,117,461,120,457,131,455,141,458,142,464,137,463,134,496,114,497,112,542,126,544,125,577,127,585,72,585,66,578,69,556'
      }
    }, {
      title: 'Windham County',
      filename: 'windham.pdf',
      coords: {
        full: '403,585,482,584,464,564,467,540,478,526,477,507,480,495,475,486,480,469,453,472,436,473,415,467,410,489,413,500,390,500,388,541,404,542,401,570',
        small: '139,464,157,471,181,470,207,468,208,496,205,526,192,551,197,571,209,582,206,586,128,586,128,543,115,540,115,498,138,498,137,483'
      }
    }
  ];

  initialize = function($) {
    var i,
        $map = $('<map></map>'),
        $wrapper = $('<div></div>');

    $img.attr('src', getSrc('0'))
        .attr('usemap', '#'+options.mapname)
        .attr('alt', 'Vermont');

    $map.attr('name', options.mapname)
        .css({ 'z-index': 1001 });

    for(i = 0; i < config.length; i += 1) {
      var $area = $('<area></area>');

      $area.attr('href', options.filepath + config[i].filename)
           .attr('coords', config[i].coords[options.size])
           .attr('shape', 'poly')
           .attr('alt', config[i].title)
           .attr('data-county', (i+1));

      $map.append($area);
    }

    $map.find('area').hover(self.hoverIn, self.hoverOut);

    $wrapper.append($img)
            .append($map);

    $replace.parents('table').css({ width: '100%' });
    $replace.replaceWith($wrapper);
  };

  self.handleClick = function() {
    var $el = jQuery(this),
        county = config[(parseInt($el.attr('data-county'))-1)];

    // return false;
  };

  self.hoverIn = function() {
    var $el = jQuery(this),
        county = getCounty($el);

    $img.attr('src', getSrc($el.attr('data-county')));
  };

  self.hoverOut = function() {
    $img.attr('src', getSrc('0'));
  };

  // private

  getCounty = function($el) {
    return config[(parseInt($el.attr('data-county'))-1)];
  };

  getSrc = function(n) {
   return urlBase + options.size + '/' + n + ext;
  };

  initialize(jQuery);
};
